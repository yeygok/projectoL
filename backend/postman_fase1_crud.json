{
  "info": {
    "name": "Lavado Vapor - FASE 1 - CRUD Categorías y Tipos",
    "description": "Colección de Postman para probar las nuevas rutas CRUD implementadas en la Fase 1",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000/api",
      "type": "string"
    },
    {
      "key": "token",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "0. AUTENTICACIÓN",
      "item": [
        {
          "name": "Login Admin",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('token', response.token);",
                  "    pm.environment.set('token', response.token);",
                  "    console.log('✅ Token guardado:', response.token);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@lavadovapor.com\",\n  \"password\": \"admin123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "Login como administrador para obtener el token JWT"
          }
        },
        {
          "name": "Verify Token",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/auth/verify",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "verify"]
            }
          }
        }
      ]
    },
    {
      "name": "1. CATEGORÍAS - CRUD COMPLETO",
      "item": [
        {
          "name": "GET All Categorias",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/categorias",
              "host": ["{{baseUrl}}"],
              "path": ["categorias"]
            },
            "description": "Obtener todas las categorías con conteo de servicios"
          }
        },
        {
          "name": "GET Categoria by ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/categorias/1",
              "host": ["{{baseUrl}}"],
              "path": ["categorias", "1"]
            },
            "description": "Obtener una categoría específica con sus servicios"
          }
        },
        {
          "name": "POST Create Categoria",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nombre\": \"Limpieza de Oficinas\",\n  \"descripcion\": \"Servicios especializados de limpieza para espacios de oficina\",\n  \"icono\": \"office\",\n  \"orden\": 10\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/categorias",
              "host": ["{{baseUrl}}"],
              "path": ["categorias"]
            },
            "description": "Crear nueva categoría - Solo Admin"
          }
        },
        {
          "name": "PUT Update Categoria",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nombre\": \"Limpieza de Oficinas Premium\",\n  \"descripcion\": \"Servicios especializados de limpieza para espacios de oficina - Incluye desinfección\",\n  \"icono\": \"office_premium\",\n  \"orden\": 8,\n  \"activa\": 1\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/categorias/8",
              "host": ["{{baseUrl}}"],
              "path": ["categorias", "8"]
            },
            "description": "Actualizar categoría existente - Solo Admin"
          }
        },
        {
          "name": "DELETE Categoria",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/categorias/8",
              "host": ["{{baseUrl}}"],
              "path": ["categorias", "8"]
            },
            "description": "Desactivar categoría (soft delete) - Solo Admin"
          }
        },
        {
          "name": "PUT Reactivar Categoria",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/categorias/8/reactivar",
              "host": ["{{baseUrl}}"],
              "path": ["categorias", "8", "reactivar"]
            },
            "description": "Reactivar categoría desactivada - Solo Admin"
          }
        }
      ]
    },
    {
      "name": "2. TIPOS DE SERVICIO - CRUD COMPLETO",
      "item": [
        {
          "name": "GET All Tipos Servicio",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/tipos-servicio",
              "host": ["{{baseUrl}}"],
              "path": ["tipos-servicio"]
            },
            "description": "Obtener todos los tipos de servicio (público)"
          }
        },
        {
          "name": "GET Tipo Servicio by ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/tipos-servicio/1",
              "host": ["{{baseUrl}}"],
              "path": ["tipos-servicio", "1"]
            },
            "description": "Obtener un tipo de servicio específico"
          }
        },
        {
          "name": "POST Create Tipo Servicio",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nombre\": \"Ultra Premium\",\n  \"descripcion\": \"Servicio de máxima calidad con productos premium y acabados especiales\",\n  \"multiplicador_precio\": 1.80,\n  \"color\": \"#FF6B35\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/tipos-servicio",
              "host": ["{{baseUrl}}"],
              "path": ["tipos-servicio"]
            },
            "description": "Crear nuevo tipo de servicio - Solo Admin"
          }
        },
        {
          "name": "PUT Update Tipo Servicio",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nombre\": \"Ultra Premium Plus\",\n  \"descripcion\": \"Servicio de máxima calidad con productos premium, acabados especiales y garantía extendida\",\n  \"multiplicador_precio\": 2.00,\n  \"color\": \"#FF0000\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/tipos-servicio/6",
              "host": ["{{baseUrl}}"],
              "path": ["tipos-servicio", "6"]
            },
            "description": "Actualizar tipo de servicio - Solo Admin"
          }
        },
        {
          "name": "DELETE Tipo Servicio",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/tipos-servicio/6",
              "host": ["{{baseUrl}}"],
              "path": ["tipos-servicio", "6"]
            },
            "description": "Eliminar tipo de servicio (hard delete) - Solo Admin"
          }
        }
      ]
    },
    {
      "name": "3. ESTADOS DE RESERVA - CRUD COMPLETO",
      "item": [
        {
          "name": "GET All Estados Reserva",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/estados-reserva",
              "host": ["{{baseUrl}}"],
              "path": ["estados-reserva"]
            },
            "description": "Obtener todos los estados de reserva (público)"
          }
        },
        {
          "name": "GET Estado Reserva by ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/estados-reserva/1",
              "host": ["{{baseUrl}}"],
              "path": ["estados-reserva", "1"]
            },
            "description": "Obtener un estado específico con reservas asociadas"
          }
        },
        {
          "name": "GET Estadisticas Estados",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/estados-reserva/stats/resumen",
              "host": ["{{baseUrl}}"],
              "path": ["estados-reserva", "stats", "resumen"]
            },
            "description": "Obtener estadísticas de reservas por estado"
          }
        },
        {
          "name": "POST Create Estado Reserva",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"estado\": \"en_camino\",\n  \"descripcion\": \"El técnico está en camino hacia la ubicación del servicio\",\n  \"color\": \"#17A2B8\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/estados-reserva",
              "host": ["{{baseUrl}}"],
              "path": ["estados-reserva"]
            },
            "description": "Crear nuevo estado de reserva - Solo Admin"
          }
        },
        {
          "name": "PUT Update Estado Reserva",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"estado\": \"en_camino\",\n  \"descripcion\": \"El técnico se encuentra en ruta hacia la ubicación del cliente\",\n  \"color\": \"#007BFF\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/estados-reserva/8",
              "host": ["{{baseUrl}}"],
              "path": ["estados-reserva", "8"]
            },
            "description": "Actualizar estado de reserva - Solo Admin"
          }
        },
        {
          "name": "DELETE Estado Reserva",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/estados-reserva/8",
              "host": ["{{baseUrl}}"],
              "path": ["estados-reserva", "8"]
            },
            "description": "Eliminar estado de reserva (hard delete) - Solo Admin"
          }
        }
      ]
    },
    {
      "name": "4. TESTS DE VALIDACIÓN",
      "item": [
        {
          "name": "TEST - Categoria sin nombre (400)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"descripcion\": \"Test sin nombre\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/categorias",
              "host": ["{{baseUrl}}"],
              "path": ["categorias"]
            },
            "description": "Debe retornar 400 - nombre requerido"
          }
        },
        {
          "name": "TEST - Estado sin nombre (400)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"descripcion\": \"Estado sin nombre\",\n  \"color\": \"#000000\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/estados-reserva",
              "host": ["{{baseUrl}}"],
              "path": ["estados-reserva"]
            },
            "description": "Debe retornar 400 - Campo requerido"
          }
        },
        {
          "name": "TEST - Estado duplicado (409)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"estado\": \"pendiente\",\n  \"descripcion\": \"Estado duplicado\",\n  \"color\": \"#FFC107\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/estados-reserva",
              "host": ["{{baseUrl}}"],
              "path": ["estados-reserva"]
            },
            "description": "Debe retornar 409 - Estado ya existe"
          }
        },
        {
          "name": "TEST - Delete estado crítico (400)",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/estados-reserva/1",
              "host": ["{{baseUrl}}"],
              "path": ["estados-reserva", "1"]
            },
            "description": "Debe retornar 400 - No se puede eliminar estado crítico"
          }
        },
        {
          "name": "TEST - Categoria nombre duplicado (409)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nombre\": \"Colchones\",\n  \"descripcion\": \"Test duplicado\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/categorias",
              "host": ["{{baseUrl}}"],
              "path": ["categorias"]
            },
            "description": "Debe retornar 409 - nombre ya existe"
          }
        },
        {
          "name": "TEST - Tipo color inválido (400)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nombre\": \"Test Color\",\n  \"color\": \"rojo\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/tipos-servicio",
              "host": ["{{baseUrl}}"],
              "path": ["tipos-servicio"]
            },
            "description": "Debe retornar 400 - color debe ser formato HEX"
          }
        },
        {
          "name": "TEST - Tipo multiplicador inválido (400)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nombre\": \"Test Multiplicador\",\n  \"multiplicador_precio\": 15\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/tipos-servicio",
              "host": ["{{baseUrl}}"],
              "path": ["tipos-servicio"]
            },
            "description": "Debe retornar 400 - multiplicador fuera de rango"
          }
        },
        {
          "name": "TEST - Sin token (401)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nombre\": \"Test Sin Auth\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/categorias",
              "host": ["{{baseUrl}}"],
              "path": ["categorias"]
            },
            "description": "Debe retornar 401 - no autenticado"
          }
        }
      ]
    }
  ]
}
